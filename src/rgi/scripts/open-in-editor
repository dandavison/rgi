#!/bin/bash

file="$1"
line="$2"
editor="${RGI_EDITOR:-${EDITOR:-vscode}}"

# Convert relative path to absolute path for editor URLs
# This allows users to search with relative paths but still open files correctly
if [[ ! "$file" = /* ]]; then
    # Use realpath if available, otherwise fallback to a portable solution
    if command -v realpath >/dev/null 2>&1; then
        file="$(realpath "$file")"
    else
        # Portable fallback
        file="$(cd "$(dirname "$file")" 2>/dev/null && pwd)/$(basename "$file")"
    fi
fi

case "$editor" in
    idea|intellij)
        open "idea://open?file=$file&line=$line"
        ;;
    vscode|code)
        open "vscode://file/$file:$line"
        ;;
    cursor)
        open "cursor://file/$file:$line"
        ;;
    wormhole)
        wormhole "$file":"$line"
        ;;
    vim)
        vim "+$line" "$file"
        ;;
    *)
        if command -v "$editor" >/dev/null 2>&1; then
            "$editor" "+$line" "$file"
        else
            echo "Error: Unknown editor '$editor'. Set RGI_EDITOR or EDITOR to one of:" >&2
            echo "idea, vscode, cursor, wormhole, vim" >&2
            exit 1
        fi
        ;;
esac